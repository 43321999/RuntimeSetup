<span align="center">
  
  # [wireguard](https://ubuntu.com/server/docs/wireguard-vpn-introduction)

  ## Dockerfile
  ```sh
  FROM ubuntu

RUN \
echo "**** install dependencies ****" && \
apt-get update && \
apt-get install -y --no-install-recommends \
iproute2 && \
echo "**** install wireguard-tools ****" && \
apt-get install -y --no-install-recommends \
wireguard-tools && \
echo "**** clean up ****" && \
rm -rf \
  /tmp/* \
  /var/lib/apt/lists/* \
  /var/tmp/*
  ```
  
 ```docker build -t wireguard:00 ~/apps/wireguard```
  
</span>

## genkey
### genkey.sh
```sh
#!/bin/bash

umask 077
wg genkey | tee private.key | wg pubkey > public.key

```
### run
```sh
docker run --rm \
-v ~/apps/wireguard:/etc/wireguard/ \
-w /etc/wireguard/ \
wireguard \
./genkey.sh
```

```sh
#
# rename keys and repeate docker run
#
mv private.key site-private.key
mv public.key site-public.key
#
# docker run ...
#
```
## configs
create```~/apps/wireguard/00.conf``` with [IDE](/vscode/README.md) and paste


```txt
[Interface]
PrivateKey = <site-private.key>
ListenPort = 1025
Address = fc00::/7

[Peer]
PublicKey = <peer-public.key>
AllowedIPs = fc1b::/128
Endpoint = 43.207.172.176:1025
PersistentKeepalive = 25
```
```vi ~/apps/wireguard/1b.conf```
```txt
[Interface]
PrivateKey = <peer-private.key>
ListenPort = 1025
Address = fc1b::/128
SaveConfig = true

[Peer]
PublicKey = <site-public.key>
AllowedIPs = fc00::/7
```
### setup.sh
```sh
#!/bin/bash

if 
    ip a | grep $VAR1: & ip a | grep fc$VAR1:: ; 
then 
    ip link del $VAR1
fi
wg-quick up /home/admin/mnt/$VAR1.conf && \
sleep infinity & wait $!
```
## 00 runtime:
### Dockerfile
```sh
docker run -d \
--network host \
--name=wireguard.00 \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-e VAR1=00 \
-v /lib/modules:/lib/modules \
-v ~/apps/wireguard:/home/admin/mnt \
-w /home/admin/ \
--restart unless-stopped \
wireguard:00 \
./mnt/setup.sh
```
## 1b runtime:
### Dockerfile
```yaml
# see Dockerfile above
```
```
docker build -t wireguard:1b ~/apps/wireguard/
```
### setup.sh
```sh
# see setup.sh above
```
```sh
docker run -d \
--network host \
--name=wireguard.1b \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-e VAR1=1b \
-v /lib/modules:/lib/modules \
-v ~/apps/wireguard:/home/admin/mnt \
-w /home/admin/ \
--restart unless-stopped \
wireguard:1b \
./mnt/setup.sh
```
