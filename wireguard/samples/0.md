<span align="center">
  
  # [wireguard](https://ubuntu.com/server/docs/wireguard-vpn-introduction)

</span>

## keygen
### Dockerfile
```yaml
FROM ubuntu

RUN \
echo "**** install wireguard-tools ****" && \
apt-get update && \
apt-get install -y --no-install-recommends \
wireguard && \
echo "**** clean up ****" && \
rm -rf \
  /tmp/* \
  /var/lib/apt/lists/* \
  /var/tmp/* 

ENTRYPOINT \
umask 077 \
wg genkey | tee private.key | wg pubkey > public.key
```

```docker build -t wireguard:keys ~/apps/wireguard/app```

```sh
docker run --rm \
-v ~/apps/wireguard/app:/etc/wireguard/ \
-w /etc/wireguard/ \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-v /lib/modules:/lib/modules \
wireguard:keys
```

```sh
mv private.key site-private.key
mv public.key site-public.key
```

## 00 runtime:




>```sh
>docker run --rm \
>-v ~/apps/wireguard/apps:/etc/wireguard/ \
>-w /etc/wireguard/ \
>ubuntu
>```
  
<span align="right">
  
  local container:
>```apt update```
>```apt install --no-install-recommends wireguard iproute2 -y```

  ```umask 077```
  
  ```wg genkey | tee site-private.key | wg pubkey > site-public.key```
  
  ```wg genkey | tee peer-private.key | wg pubkey > peer-public.key```

</span>

```vi ~/apps/wireguard/00.conf```
```txt
[Interface]
PrivateKey = <site-private.key>
ListenPort = 1025
Address = fc00::/7

[Peer]
PublicKey = <peer-public.key>
AllowedIPs = fc1b::/128
Endpoint = 43.207.172.176:1025
```
<span align="right">
  
  ```mv 00.conf /etc/wireguard/```

  ```chmod 0600 /etc/wireguard/00.conf```

  ```chown root: /etc/wireguard/00.conf```
  
  ```wg-quick up 00```

</span>


## 1b runtime:

### Dockerfile
```yaml
FROM ubuntu

RUN \
echo "**** install dependencies ****" && \
apt-get update && \
apt-get install -y --no-install-recommends \
iproute2 && \
echo "**** install wireguard-tools ****" && \
apt-get install -y --no-install-recommends \
wireguard && \
echo "**** clean up ****" && \
rm -rf \
  /tmp/* \
  /var/lib/apt/lists/* \
  /var/tmp/*

COPY ~/apps/wireguard/1b.conf /etc/wireguard/

CMD \
ip link del 1b && \
wg-quick up 1b && \
sleep infinity & wait $! ||\
\
wg-quick up 1b && \
sleep infinity & wait $!
```

```docker build -t wireguard:1b ~/apps/wireguard/```

>```sh
>docker run -d \
>--network host \
>--name=wireguard.1b \
>--cap-add=NET_ADMIN \
>--cap-add=SYS_MODULE \
>-v /lib/modules:/lib/modules \
>--restart unless-stopped \
>wireguard:1b
>```

```vi ~/apps/wireguard/1b.conf```
```txt
[Interface]
PrivateKey = <peer-private.key>
ListenPort = 1025
Address = fc1b::/128

[Peer]
PublicKey = <site-public.key>
AllowedIPs = fc00::/7
```

<span align="right">
  
  remote container:
>```apt update```
>```apt install --no-install-recommends wireguard iproute2 -y```

  
  ```mv 1b.conf /etc/wireguard/```

  ```chmod 0600 /etc/wireguard/1b.conf```

  ```chown root: /etc/wireguard/1b.conf```
  
  ```wg-quick up 00```
</span>


```docker commit -a "Noshi Morimoshi noshi@morimoshi.com" -m github.com/43321999/RuntimeSetup/edit/mvp/wireguard/samples/0.md#1b-runtime wireguard```

```docker rm wireguard```
