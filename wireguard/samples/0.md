<span align="center">
  
  # [wireguard](https://ubuntu.com/server/docs/wireguard-vpn-introduction)

  ## Dockerfile
  ```sh
  FROM ubuntu

RUN \
echo "**** install dependencies ****" && \
apt-get update && \
apt-get install -y --no-install-recommends \
iproute2 && \
echo "**** install wireguard-tools ****" && \
apt-get install -y --no-install-recommends \
wireguard-tools && \
echo "**** clean up ****" && \
rm -rf \
  /tmp/* \
  /var/lib/apt/lists/* \
  /var/tmp/*
  ```
  
 ```docker build -t wireguard:00 ~/apps/wireguard```
  
</span>

## keygen
```sh
docker run --rm \
-v ~/apps/wireguard:/etc/wireguard/ \
-w /etc/wireguard/ \
wireguard \
wg genkey | tee private.key | wg pubkey > public.key
```

```sh
#
# rename keys and repeate docker run
#
mv private.key site-private.key
mv public.key site-public.key
#
# docker run ...
#
```

```vi ~/apps/wireguard/00.conf``` or 
```sh
docker run -it --rm -v ~/apps/vscode:/root/apps/vscode -v ~/apps/wireguard:/root/apps/wireguard -w /root/apps/vscode/ ubuntu \
apt update && \
apt install -y --no-install-recommends \
curl && \
bash
```
```./code tunnel```
```txt
[Interface]
PrivateKey = <site-private.key>
ListenPort = 1025
Address = fc00::/7

[Peer]
PublicKey = <peer-public.key>
AllowedIPs = fc1b::/128
Endpoint = 43.207.172.176:1025
PersistentKeepalive = 25
```

```vi ~/apps/wireguard/1b.conf```
```txt
[Interface]
PrivateKey = <peer-private.key>
ListenPort = 1025
Address = fc1b::/128
SaveConfig = true

[Peer]
PublicKey = <site-public.key>
AllowedIPs = fc00::/7
```


## 00 runtime:

### Dockerfile
```sh
docker run -d \
--network host \
--name=wireguard.00 \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-v /lib/modules:/lib/modules \
--restart unless-stopped \
wireguard:00 \
ip link del 00 && \
wg-quick up 00 && \
sleep infinity & wait $! ||\
\
wg-quick up 00 && \
sleep infinity & wait $!
```
  
<span align="right">
  
  local container:
```sh
  ###
```
</span>


<span align="right">
  
  ```sh
  #
  #
  #
  ```
</span>


## 1b runtime:

### Dockerfile
```yaml
# see Dockerfile above
```

```
docker build -t wireguard:1b ~/apps/wireguard/
```

>```sh
>docker run -d \
>--network host \
>--name=wireguard.1b \
>--cap-add=NET_ADMIN \
>--cap-add=SYS_MODULE \
>-v /lib/modules:/lib/modules \
>--restart unless-stopped \
>wireguard:1b \
>```

<span align="right">
  
  remote container:
```sh
  #
  #
  #
```
</span>

#### debug
```sh
docker run -d \
--network host \
--name=wireguard.1b \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-v /lib/modules:/lib/modules \
-v ~/apps/wireguard:/etc/wireguard/ \
--restart unless-stopped \
wireguard:1b
```
